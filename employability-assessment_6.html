<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employability Assessment System</title>
<style>
:root{--p:#2563eb;--pd:#1d4ed8;--pl:#eff6ff;--pu:#7c3aed;--g:#10b981;--y:#f59e0b;--r:#ef4444;
--bg:#f1f5f9;--s:#fff;--s2:#f8fafc;--b:#e2e8f0;--t:#0f172a;--t2:#64748b;--t3:#94a3b8;
--sh:0 1px 4px rgba(0,0,0,.08),0 4px 16px rgba(0,0,0,.06);--shl:0 8px 32px rgba(0,0,0,.12);
--r1:12px;--sw:240px;--th:60px}
.dark{--bg:#0f172a;--s:#1e293b;--s2:#0f172a;--b:#334155;--t:#f1f5f9;--t2:#94a3b8;--t3:#475569;--pl:#1e3a5f}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--t);transition:background .3s,color .3s;min-height:100vh}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes fadein{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.hidden{display:none!important}
.page{display:none}.page.show{display:block}
.view{display:none}.view.show{display:block;animation:fadein .3s ease}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;border:none;cursor:pointer;transition:all .2s;font-family:inherit;white-space:nowrap}
.btn:disabled{opacity:.5;cursor:not-allowed}
.btn-p{background:var(--p);color:#fff}.btn-p:hover:not(:disabled){background:var(--pd);transform:translateY(-1px);box-shadow:0 4px 12px rgba(37,99,235,.4)}
.btn-s{background:var(--s);color:var(--t);border:1.5px solid var(--b)}.btn-s:hover:not(:disabled){background:var(--bg)}
.btn-d{background:var(--r);color:#fff}.btn-d:hover:not(:disabled){background:#dc2626}
.btn-g{background:transparent;color:var(--p)}.btn-g:hover{background:var(--pl)}
.btn-sm{padding:6px 12px;font-size:13px}.btn-lg{padding:13px 28px;font-size:16px;border-radius:10px}
.btn-full{width:100%;justify-content:center}

/* CARDS & BADGES */
.card{background:var(--s);border-radius:var(--r1);box-shadow:var(--sh);border:1px solid var(--b)}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600}
.b-green{background:#d1fae5;color:#065f46}.b-red{background:#fee2e2;color:#991b1b}
.b-blue{background:#dbeafe;color:#1e40af}.b-yellow{background:#fef3c7;color:#92400e}
.dark .b-green{background:#064e3b;color:#6ee7b7}.dark .b-red{background:#7f1d1d;color:#fca5a5}
.dark .b-blue{background:#1e3a5f;color:#93c5fd}.dark .b-yellow{background:#78350f;color:#fcd34d}

/* FORMS */
input,select,textarea{width:100%;padding:10px 14px;border-radius:8px;font-size:14px;border:1.5px solid var(--b);background:var(--s);color:var(--t);outline:none;transition:border-color .2s,box-shadow .2s;font-family:inherit}
input:focus,select:focus,textarea:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
label{display:block;font-size:13px;font-weight:600;color:var(--t2);margin-bottom:6px}
.fg{margin-bottom:16px}

/* TOAST */
#toasts{position:fixed;top:18px;right:18px;z-index:9999;display:flex;flex-direction:column;gap:10px;pointer-events:none}
.toast{display:flex;align-items:center;gap:10px;padding:13px 18px;border-radius:10px;background:var(--s);box-shadow:var(--shl);border-left:4px solid var(--p);font-size:14px;font-weight:500;color:var(--t);min-width:280px;max-width:360px;pointer-events:all;animation:fadein .3s ease}
.t-success{border-color:var(--g)}.t-error{border-color:var(--r)}.t-warning{border-color:var(--y)}.t-info{border-color:var(--p)}

/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:2000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadein .2s ease}
.modal-box{background:var(--s);border-radius:16px;box-shadow:var(--shl);padding:28px;width:100%;max-width:480px;animation:fadein .3s ease;max-height:90vh;overflow-y:auto}
.modal-box h2{font-size:20px;margin-bottom:10px}
.m-desc{color:var(--t2);font-size:14px;line-height:1.6;margin-bottom:20px}
.m-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}

/* LOADING */
#loading{position:fixed;inset:0;background:rgba(255,255,255,.92);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:3000;gap:16px}
.dark #loading{background:rgba(15,23,42,.92)}
.spinner{width:38px;height:38px;border:3px solid var(--b);border-top-color:var(--p);border-radius:50%;animation:spin .8s linear infinite}
#loading p{font-size:14px;color:var(--t2);font-weight:500}

/* LANDING */
#landing-page{min-height:100vh}
.lnav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:68px;background:var(--s);box-shadow:0 1px 0 var(--b);position:sticky;top:0;z-index:100}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:38px;height:38px;background:linear-gradient(135deg,#2563eb,#7c3aed);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:10px;font-weight:800;flex-shrink:0}
.logo-text .lname{font-size:13px;font-weight:800;color:var(--p)}.logo-text .lsub{font-size:9px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.05em}
.hero-sec{background:linear-gradient(135deg,#eff6ff 0%,#f0fdf4 50%,#faf5ff 100%);padding:80px 40px}
.dark .hero-sec{background:linear-gradient(135deg,#0f172a,#1e1b4b)}
.hero-inner{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:60px;align-items:center}
.hero h1{font-size:46px;font-weight:800;line-height:1.1;margin-bottom:18px;background:linear-gradient(135deg,#2563eb,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:17px;color:var(--t2);line-height:1.7;margin-bottom:28px}
.hero-badge{display:inline-flex;align-items:center;gap:6px;background:var(--pl);color:var(--p);font-size:13px;font-weight:600;padding:5px 12px;border-radius:20px;margin-bottom:18px}
.pcard{background:var(--s);border-radius:16px;box-shadow:var(--shl);border:1px solid var(--b);padding:24px}
.pbar-wrap{margin:10px 0}.pbar-lbl{display:flex;justify-content:space-between;font-size:13px;color:var(--t2);margin-bottom:4px}
.pbar{height:8px;background:var(--b);border-radius:4px;overflow:hidden}
.pbar-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,#2563eb,#7c3aed)}
.stat-row{display:flex;gap:10px;margin-top:18px}
.stat-pill{flex:1;text-align:center;padding:12px;background:var(--pl);border-radius:10px}
.stat-pill .snum{font-size:24px;font-weight:800;color:var(--p)}.stat-pill .slbl{font-size:11px;color:var(--t2);margin-top:2px}
.feat-sec{padding:70px 40px;max-width:1100px;margin:0 auto}
.feat-sec h2{text-align:center;font-size:32px;font-weight:800;margin-bottom:10px}
.feat-sub{text-align:center;color:var(--t2);font-size:16px;margin-bottom:40px}
.feat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.fcard{padding:24px;border-radius:var(--r1);background:var(--s);border:1px solid var(--b);transition:all .2s}
.fcard:hover{transform:translateY(-4px);box-shadow:var(--shl);border-color:var(--p)}
.fcard-icon{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:14px}
.fcard h3{font-size:16px;font-weight:700;margin-bottom:7px}.fcard p{font-size:13px;color:var(--t2);line-height:1.6}
footer{background:var(--s);border-top:1px solid var(--b);padding:28px 40px;text-align:center;color:var(--t3);font-size:13px}
footer a{color:var(--t2);margin:0 10px;cursor:pointer}footer a:hover{color:var(--p)}

/* AUTH */
.auth-layout{min-height:100vh;display:grid;grid-template-columns:1fr 1fr}
.auth-left{background:linear-gradient(135deg,#1d4ed8,#7c3aed);display:flex;align-items:center;justify-content:center;padding:60px;position:relative;overflow:hidden}
.auth-left::before{content:'';position:absolute;width:400px;height:400px;border-radius:50%;background:rgba(255,255,255,.05);top:-100px;right:-100px}
.auth-left::after{content:'';position:absolute;width:280px;height:280px;border-radius:50%;background:rgba(255,255,255,.05);bottom:-70px;left:-70px}
.auth-lc{color:#fff;text-align:center;position:relative;z-index:1}
.auth-lc h2{font-size:32px;font-weight:800;margin-bottom:14px}
.auth-lc p{opacity:.85;font-size:15px;line-height:1.7}
.auth-list{margin-top:28px;display:flex;flex-direction:column;gap:10px;text-align:left;font-size:15px}
.auth-right{display:flex;align-items:center;justify-content:center;padding:40px;background:var(--bg)}
.auth-card{width:100%;max-width:420px}
.auth-card h1{font-size:26px;font-weight:800;margin-bottom:5px}
.auth-sub{color:var(--t2);font-size:14px;margin-bottom:24px}
.auth-note{text-align:center;font-size:13px;color:var(--t2);margin-top:18px}
.auth-note a{color:var(--p);font-weight:600;cursor:pointer}
.divider{display:flex;align-items:center;gap:12px;margin:18px 0;color:var(--t3);font-size:12px}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--b)}
.back-lnk{cursor:pointer;color:var(--t2);font-size:13px;margin-bottom:20px;display:inline-flex;align-items:center;gap:4px}
.back-lnk:hover{color:var(--p)}
.gbtn{width:100%;padding:11px;border-radius:8px;border:1.5px solid var(--b);background:var(--s);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;font-size:14px;font-weight:600;color:var(--t);transition:all .2s;font-family:inherit}
.gbtn:hover{background:var(--bg);border-color:var(--p)}

/* SHELL */
.sidebar{width:var(--sw);background:var(--s);border-right:1px solid var(--b);display:flex;flex-direction:column;position:fixed;top:0;bottom:0;left:0;z-index:200;transition:transform .3s;overflow-y:auto}
.sidebar.hide{transform:translateX(-100%)}
.sb-hd{padding:16px 18px;border-bottom:1px solid var(--b);display:flex;align-items:center;gap:10px;flex-shrink:0}
.sb-nav{flex:1;padding:10px 8px}
.navlink{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .15s;color:var(--t2);margin-bottom:2px}
.navlink:hover{background:var(--pl);color:var(--p)}.navlink.active{background:var(--p);color:#fff}
.navlink .ico{font-size:17px;width:22px;text-align:center;flex-shrink:0}
.nav-sec-lbl{font-size:11px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:.07em;padding:12px 12px 4px}
.sb-ft{padding:10px 8px;border-top:1px solid var(--b);flex-shrink:0}
.topbar{position:fixed;top:0;left:var(--sw);right:0;height:var(--th);background:var(--s);border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:100;transition:left .3s}
.topbar.full{left:0}
.tb-left{display:flex;align-items:center;gap:12px}
.tb-right{display:flex;align-items:center;gap:14px}
.menu-btn{background:none;border:none;cursor:pointer;font-size:20px;color:var(--t2);padding:5px;border-radius:6px}
.menu-btn:hover{background:var(--bg)}
.bc{font-size:14px;color:var(--t2)}.bc b{color:var(--t)}
.uav{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#2563eb,#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px;cursor:pointer;flex-shrink:0}
.dkbtn{background:var(--bg);border:1.5px solid var(--b);border-radius:20px;padding:4px 10px;cursor:pointer;font-size:15px}
.main{margin-left:var(--sw);margin-top:var(--th);padding:24px;transition:margin-left .3s}
.main.full{margin-left:0}
.sb-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:199}

/* PAGE HEADER */
.ph{margin-bottom:22px}.ph h1{font-size:22px;font-weight:800}.ph p{color:var(--t2);font-size:14px;margin-top:3px}
.phr{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.scard{padding:20px}.scard .sico{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;margin-bottom:12px}
.scard .snum{font-size:28px;font-weight:800;margin-bottom:3px}.scard .slbl{font-size:13px;color:var(--t2)}

/* TABLE */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:14px}
th{text-align:left;font-size:12px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:.04em;padding:9px 14px;border-bottom:1.5px solid var(--b)}
td{padding:11px 14px;border-bottom:1px solid var(--b);color:var(--t);vertical-align:middle}
tr:last-child td{border-bottom:none}tbody tr:hover td{background:var(--bg)}
.rnk{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;background:var(--pl);color:var(--p)}
.rnk.gold{background:#fef3c7;color:#92400e}.rnk.silver{background:#f1f5f9;color:#475569}.rnk.bronze{background:#fed7aa;color:#9a3412}

/* CANDIDATES */
.cand-item{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-radius:10px;border:1px solid var(--b);background:var(--s);margin-bottom:10px;transition:all .2s;flex-wrap:wrap;gap:10px}
.cand-item:hover{border-color:var(--p)}
.cav{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;color:#fff;flex-shrink:0}

/* TEST CARDS */
.tgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px}
.tcard{padding:20px;transition:all .2s}.tcard:hover{transform:translateY(-2px);box-shadow:var(--shl)}
.tcard-title{font-size:15px;font-weight:700}
.tcard-meta{display:flex;flex-direction:column;gap:5px;margin:10px 0 14px}
.tcard-mi{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--t2)}
.tsw{position:relative;width:40px;height:22px;flex-shrink:0}
.tsw input{opacity:0;width:0;height:0}
.tsl{position:absolute;inset:0;background:var(--b);border-radius:11px;cursor:pointer;transition:.2s}
.tsl::before{content:'';position:absolute;width:18px;height:18px;left:2px;top:2px;background:#fff;border-radius:50%;transition:.2s}
.tsw input:checked+.tsl{background:var(--g)}.tsw input:checked+.tsl::before{transform:translateX(18px)}
.add-tcard{border:2px dashed var(--b);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:190px;gap:10px;box-shadow:none;border-radius:var(--r1);background:transparent;transition:all .2s}
.add-tcard:hover{border-color:var(--p);background:var(--pl)}

/* CREATE TEST */
.create-layout{display:grid;grid-template-columns:1fr 1fr;gap:22px}
.qcard{padding:18px;border-radius:10px;background:var(--bg);border:1px solid var(--b);margin-bottom:14px}
.opts-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.opt-row{display:flex;align-items:center;gap:8px;padding:9px 11px;border-radius:8px;border:1.5px solid var(--b);background:var(--s);cursor:pointer;transition:all .15s}
.opt-row.correct{border-color:var(--g);background:#d1fae5}.dark .opt-row.correct{background:#064e3b}
.opt-radio{width:16px;height:16px;border-radius:50%;border:2px solid var(--b);flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .15s;pointer-events:none}
.opt-row.correct .opt-radio{border-color:var(--g);background:var(--g)}
.opt-row.correct .opt-radio::after{content:'';width:6px;height:6px;border-radius:50%;background:#fff}
.opt-row input[type=text]{border:none;background:transparent;padding:0;font-size:13px;color:var(--t);cursor:text;flex:1}
.opt-row.correct input[type=text]{color:#065f46;font-weight:600}.dark .opt-row.correct input[type=text]{color:#6ee7b7}
.opt-row input[type=text]:focus{outline:none;box-shadow:none;border:none}

/* TOOLBAR */
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:12px}
.sbox{position:relative}.sbox input{padding-left:34px;width:220px}.sicon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--t3);font-size:14px}

/* RESULT HERO */
.result-hero{text-align:center;padding:36px;background:linear-gradient(135deg,var(--p),var(--pu));border-radius:16px;color:#fff;margin-bottom:22px}
.score-circle{width:110px;height:110px;border-radius:50%;border:5px solid rgba(255,255,255,.4);display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto 18px;background:rgba(255,255,255,.15)}
.score-circle .pct{font-size:32px;font-weight:800}.score-circle .of-lbl{font-size:12px;opacity:.8}
.result-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
.rstat{padding:16px;text-align:center}.rstat .rv{font-size:24px;font-weight:800;margin-bottom:3px}.rstat .rk{font-size:12px;color:var(--t2)}

/* TAKE TEST */
.test-layout{display:grid;grid-template-columns:1fr 260px;gap:22px}
.timer-row{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:var(--s);border-radius:var(--r1);border:1px solid var(--b);margin-bottom:20px}
.timer-disp{font-size:26px;font-weight:800;color:var(--p);font-family:monospace}
.timer-disp.warn{color:var(--y);animation:pulse 1s infinite}.timer-disp.danger{color:var(--r);animation:pulse .5s infinite}
.qpanel{padding:24px;border-radius:var(--r1);background:var(--s);border:1px solid var(--b);margin-bottom:18px}
.qmeta{font-size:12px;font-weight:700;color:var(--p);margin-bottom:10px}
.qtext{font-size:16px;font-weight:600;line-height:1.6;margin-bottom:20px}
.opt-btn{width:100%;text-align:left;padding:12px 16px;border-radius:10px;border:1.5px solid var(--b);background:var(--bg);cursor:pointer;font-size:14px;transition:all .15s;margin-bottom:8px;display:flex;align-items:center;gap:10px;color:var(--t);font-family:inherit}
.opt-btn:hover{border-color:var(--p);background:var(--pl)}
.opt-btn.sel{border-color:var(--p);background:var(--pl);color:var(--p);font-weight:600}
.opt-ltr{width:28px;height:28px;border-radius:50%;background:var(--b);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;flex-shrink:0}
.opt-btn.sel .opt-ltr{background:var(--p);color:#fff}
.qnav{display:flex;align-items:center;justify-content:space-between;margin-top:18px}
.qdotgrid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.qdot{width:34px;height:34px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;cursor:pointer;border:2px solid var(--b);background:var(--bg);color:var(--t2);transition:all .15s}
.qdot.ans{background:var(--g);border-color:var(--g);color:#fff}.qdot.cur{border-color:var(--p);color:var(--p);background:var(--pl)}

/* PROFILE */
.profile-layout{display:grid;grid-template-columns:250px 1fr;gap:22px}
.profile-left{padding:28px;text-align:center}
.profile-av{width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,#2563eb,#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-size:30px;font-weight:800;margin:0 auto 14px}

/* GOOGLE PICKER */
.gcard{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:10px;border:1.5px solid var(--b);cursor:pointer;transition:all .2s;margin-bottom:10px}
.gcard:hover{border-color:var(--p);background:var(--pl)}
.gav{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;color:#fff;flex-shrink:0}
.gadd{display:flex;align-items:center;gap:10px;padding:10px 14px;cursor:pointer;color:var(--p);font-size:14px;font-weight:600;border-radius:10px;border:1.5px dashed var(--b)}
.gadd:hover{background:var(--pl);border-color:var(--p)}

@media(max-width:1100px){.stats-row{grid-template-columns:repeat(2,1fr)}.create-layout{grid-template-columns:1fr}.test-layout{grid-template-columns:1fr}.result-grid{grid-template-columns:repeat(2,1fr)}.profile-layout{grid-template-columns:1fr}.feat-grid{grid-template-columns:repeat(2,1fr)}.hero-inner{grid-template-columns:1fr}.pcard{display:none}}
@media(max-width:768px){.auth-layout{grid-template-columns:1fr}.auth-left{display:none}.lnav{padding:0 16px}.hero-sec{padding:50px 20px}.hero h1{font-size:32px}.feat-sec{padding:40px 16px}.feat-grid{grid-template-columns:1fr}.sidebar{transform:translateX(-100%)}.sidebar.mob{transform:translateX(0)}.topbar{left:0!important}.main{margin-left:0!important}.stats-row{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading" class="hidden"><div class="spinner"></div><p id="load-msg">Loading...</p></div>
<div id="toasts"></div>

<!-- CONFIRM MODAL -->
<div id="cmodal" class="modal-bg hidden">
  <div class="modal-box">
    <h2 id="cm-t">Confirm</h2>
    <div class="m-desc" id="cm-b">Are you sure?</div>
    <div class="m-actions">
      <button class="btn btn-s" id="cm-no">Cancel</button>
      <button class="btn btn-p" id="cm-yes">Confirm</button>
    </div>
  </div>
</div>

<!-- GOOGLE MODAL -->
<div id="gmodal" class="modal-bg hidden">
  <div class="modal-box" style="max-width:400px">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
      <svg width="22" height="22" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66 2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      <h3 id="gm-h" style="font-size:17px;font-weight:700">Sign in with Google</h3>
    </div>
    <p id="gm-d" style="font-size:13px;color:var(--t2);margin-bottom:16px">Choose your account.</p>
    <div id="gm-list"></div>
    <div class="gadd" onclick="gmAddAccount()"><span style="font-size:18px">+</span> Use a different account</div>
    <div style="margin-top:12px;display:flex;justify-content:flex-end"><button class="btn btn-s btn-sm" onclick="hideM('gmodal')">Cancel</button></div>
  </div>
</div>

<!-- ADD CANDIDATE MODAL -->
<div id="acmodal" class="modal-bg hidden">
  <div class="modal-box">
    <h2>‚ûï Add Candidate</h2>
    <div class="m-desc">Grant a candidate access by registering their Gmail address.</div>
    <div class="fg"><label>Full Name *</label><input type="text" id="ac-name" placeholder="John Smith"></div>
    <div class="fg"><label>Gmail Address *</label><input type="email" id="ac-email" placeholder="candidate@gmail.com"><div id="ac-err" style="font-size:12px;color:var(--r);margin-top:4px;display:none"></div></div>
    <div class="fg"><label>Assign Test (optional)</label><select id="ac-test"><option value="">‚Äî No test assigned ‚Äî</option></select></div>
    <div class="m-actions">
      <button class="btn btn-s" onclick="hideM('acmodal')">Cancel</button>
      <button class="btn btn-p" onclick="doAddCand()">Add Candidate</button>
    </div>
  </div>
</div>

<!-- RESULT DETAIL MODAL -->
<div id="rmodal" class="modal-bg hidden">
  <div class="modal-box" style="max-width:560px">
    <h2 id="rm-t">Result</h2>
    <div id="rm-b"></div>
    <div class="m-actions"><button class="btn btn-p" onclick="hideM('rmodal')">Close</button></div>
  </div>
</div>

<!-- DEPLOY MODAL -->
<div id="dmodal" class="modal-bg hidden">
  <div class="modal-box" style="max-width:540px">
    <h2>üöÄ Deploy to GitHub Pages ‚Äî Free</h2>
    <p style="color:var(--t2);font-size:13px;margin-bottom:20px">Your site will be live at a public URL in under 2 minutes, completely free.</p>
    <div style="display:flex;flex-direction:column;gap:16px">
      <div style="display:flex;gap:14px"><div style="width:30px;height:30px;border-radius:50%;background:var(--p);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;flex-shrink:0">1</div><div><b>Create a GitHub account</b><p style="font-size:13px;color:var(--t2);margin-top:3px">Go to <b>github.com</b> and sign up (free). Skip if you already have one.</p></div></div>
      <div style="display:flex;gap:14px"><div style="width:30px;height:30px;border-radius:50%;background:var(--p);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;flex-shrink:0">2</div><div><b>Create a new repository</b><p style="font-size:13px;color:var(--t2);margin-top:3px">Click <b>+ New</b> ‚Üí name it <code style="background:var(--bg);padding:2px 5px;border-radius:4px;font-size:12px">employability-assessment</code> ‚Üí set Public ‚Üí Create.</p></div></div>
      <div style="display:flex;gap:14px"><div style="width:30px;height:30px;border-radius:50%;background:var(--p);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;flex-shrink:0">3</div><div><b>Upload this file</b><p style="font-size:13px;color:var(--t2);margin-top:3px">Click <b>Add file ‚Üí Upload</b> ‚Üí drag the HTML file ‚Üí rename to <code style="background:var(--bg);padding:2px 5px;border-radius:4px;font-size:12px">index.html</code> ‚Üí Commit.</p></div></div>
      <div style="display:flex;gap:14px"><div style="width:30px;height:30px;border-radius:50%;background:var(--p);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;flex-shrink:0">4</div><div><b>Enable GitHub Pages</b><p style="font-size:13px;color:var(--t2);margin-top:3px">Settings ‚Üí Pages ‚Üí Source: main branch ‚Üí / (root) ‚Üí Save.</p></div></div>
      <div style="display:flex;gap:14px"><div style="width:30px;height:30px;border-radius:50%;background:var(--g);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;flex-shrink:0">‚úì</div><div><b>Your site is live! üéâ</b><p style="font-size:13px;color:var(--t2);margin-top:3px">Wait ~60 sec ‚Üí visit <code style="background:var(--bg);padding:2px 5px;border-radius:4px;font-size:12px">https://YOUR-USERNAME.github.io/employability-assessment/</code></p></div></div>
    </div>
    <div style="background:var(--pl);border:1px solid var(--p);border-radius:10px;padding:14px;font-size:13px;margin-top:16px">üí° <b>Tip:</b> To update, just re-upload <code style="background:var(--bg);padding:2px 5px;border-radius:4px;font-size:11px">index.html</code> ‚Äî changes go live in ~60 seconds automatically.</div>
    <div class="m-actions"><button class="btn btn-p" onclick="hideM('dmodal')">Got it!</button></div>
  </div>
</div>

<!-- ===== LANDING PAGE ===== -->
<div id="landing-page" class="page show">
  <nav class="lnav">
    <div class="logo">
      <div class="logo-icon">EAS</div>
      <div class="logo-text"><span class="lname">Employability Assessment System</span><span class="lsub">Enterprise Platform</span></div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="dkbtn" onclick="toggleDark()" id="dk1">üåô</button>
      <button class="btn btn-s btn-sm" onclick="showM('dmodal')">üöÄ Deploy Guide</button>
      <button class="btn btn-s btn-sm" onclick="goPage('admin-page')">Admin Login</button>
      <button class="btn btn-p btn-sm" onclick="goPage('cand-page')">Take Assessment</button>
    </div>
  </nav>
  <div class="hero-sec">
    <div class="hero-inner">
      <div>
        <div class="hero-badge">‚ú® Enterprise Assessment Platform</div>
        <h1>Assess Smarter,<br>Hire Better</h1>
        <p>A powerful assessment platform for HR teams, recruiters, and educational institutions. Create tests, add candidates via Gmail, and track results in real time.</p>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button class="btn btn-p btn-lg" onclick="goPage('admin-page')">üõ°Ô∏è Admin Dashboard</button>
          <button class="btn btn-s btn-lg" onclick="goPage('cand-page')">üìù Take Assessment</button>
        </div>
      </div>
      <div>
        <div class="pcard">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px"><div style="font-weight:700;font-size:14px">Live Overview</div><span class="badge b-green">‚óè Live</span></div>
          <div class="pbar-wrap"><div class="pbar-lbl"><span>JavaScript</span><span>82%</span></div><div class="pbar"><div class="pbar-fill" style="width:82%"></div></div></div>
          <div class="pbar-wrap"><div class="pbar-lbl"><span>Problem Solving</span><span>74%</span></div><div class="pbar"><div class="pbar-fill" style="width:74%"></div></div></div>
          <div class="pbar-wrap"><div class="pbar-lbl"><span>Communication</span><span>91%</span></div><div class="pbar"><div class="pbar-fill" style="width:91%"></div></div></div>
          <div class="stat-row">
            <div class="stat-pill"><div class="snum">2.4k</div><div class="slbl">Candidates</div></div>
            <div class="stat-pill"><div class="snum">98%</div><div class="slbl">Accuracy</div></div>
            <div class="stat-pill"><div class="snum">156</div><div class="slbl">Live Tests</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="feat-sec">
    <h2>Everything You Need</h2>
    <div class="feat-sub">A complete assessment ecosystem for modern hiring</div>
    <div class="feat-grid">
      <div class="fcard"><div class="fcard-icon" style="background:#dbeafe">üìä</div><h3>Real-time Analytics</h3><p>Track performance, score distributions, and candidate progress with live dashboards.</p></div>
      <div class="fcard"><div class="fcard-icon" style="background:#d1fae5">üîí</div><h3>Anti-Cheating</h3><p>Tab-switch detection, violation tracking, and auto-submit ensure test integrity.</p></div>
      <div class="fcard"><div class="fcard-icon" style="background:#fce7f3">‚ö°</div><h3>Instant Results</h3><p>Candidates see detailed score reports immediately after submission with full answer review.</p></div>
      <div class="fcard"><div class="fcard-icon" style="background:#fef3c7">üéØ</div><h3>Test Builder</h3><p>Create multi-question assessments with custom options, time limits, and correct answers.</p></div>
      <div class="fcard"><div class="fcard-icon" style="background:#ede9fe">üìà</div><h3>Performance Ranking</h3><p>Automatic ranking and percentile calculation identifies your top candidates instantly.</p></div>
      <div class="fcard"><div class="fcard-icon" style="background:#ffedd5">üë•</div><h3>Gmail-based Access</h3><p>Admin adds candidates by Gmail ‚Äî they sign in instantly, no extra registration needed.</p></div>
    </div>
  </div>
  <footer>
    <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px">
      <div class="logo-icon" style="width:28px;height:28px;font-size:9px">EAS</div>
      <span style="font-weight:800;color:var(--p)">Employability Assessment System</span>
    </div>
    <div><a>Privacy</a><a>Terms</a><a>Contact</a><a>Support</a></div>
    <div style="margin-top:10px">¬© 2024 Employability Assessment System. All rights reserved.</div>
  </footer>
</div>

<!-- ===== ADMIN LOGIN ===== -->
<div id="admin-page" class="page">
  <div class="auth-layout">
    <div class="auth-left">
      <div class="auth-lc">
        <div style="font-size:52px;margin-bottom:20px">üõ°Ô∏è</div>
        <h2>Admin Portal</h2>
        <p>Manage tests, add candidates via Gmail, and view all results from your secure dashboard.</p>
        <div class="auth-list"><div>‚úÖ Create & publish tests</div><div>‚úÖ Add candidates by Gmail</div><div>‚úÖ View analytics & results</div><div>‚úÖ Export performance reports</div></div>
      </div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="back-lnk" onclick="goPage('landing-page')">‚Üê Back to home</div>
        <h1>Admin Sign In</h1>
        <div class="auth-sub">Sign in to the Employability Assessment System</div>
        <button class="gbtn" onclick="openGM('admin')">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66 2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Sign in with Google
        </button>
        <div class="divider">or use credentials</div>
        <div class="fg"><label>Email</label><input type="email" id="admin-email" value="admin@eas.com"></div>
        <div class="fg"><label>Password</label><input type="password" id="admin-pass" value="admin123"></div>
        <div style="text-align:right;margin-bottom:18px"><a style="font-size:13px;color:var(--p);cursor:pointer" onclick="toast('Password reset email sent!','success')">Forgot password?</a></div>
        <button class="btn btn-p btn-full" onclick="loginAdmin()">Sign In to Dashboard</button>
        <div class="auth-note">Need help? <a onclick="toast('Contact: support@eas.com','info')">Contact Support</a></div>
      </div>
    </div>
  </div>
</div>

<!-- ===== CANDIDATE LOGIN ===== -->
<div id="cand-page" class="page">
  <div class="auth-layout">
    <div class="auth-left">
      <div class="auth-lc">
        <div style="font-size:52px;margin-bottom:20px">üìù</div>
        <h2>Candidate Portal</h2>
        <p>Sign in with the Gmail address your admin registered to access your assessments.</p>
        <div class="auth-list"><div>‚úÖ Sign in with your Gmail</div><div>‚úÖ Take assigned assessments</div><div>‚úÖ View instant results</div><div>‚úÖ Review your answers</div></div>
      </div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="back-lnk" onclick="goPage('landing-page')">‚Üê Back to home</div>
        <h1>Candidate Sign In</h1>
        <div class="auth-sub">Use the Gmail your admin registered you with</div>
        <button class="gbtn" onclick="openGM('candidate')">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66 2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Sign in with Google
        </button>
        <div id="cand-nf" class="hidden" style="margin:10px 0;padding:12px;border-radius:8px;background:#fee2e2;border:1px solid #fca5a5;font-size:13px;color:#991b1b">‚ö†Ô∏è This Gmail is not registered. Ask your admin to add you.</div>
        <div class="divider">or enter email</div>
        <div class="fg"><label>Gmail Address</label><input type="email" id="cand-email" placeholder="yourname@gmail.com"></div>
        <div class="fg"><label>Password</label><input type="password" id="cand-pass" placeholder="Password"></div>
        <button class="btn btn-p btn-full" onclick="loginCand()">Sign In</button>
        <div class="auth-note">Not registered? <a onclick="goPage('reg-page')">Request Access</a></div>
      </div>
    </div>
  </div>
</div>

<!-- ===== REGISTER PAGE ===== -->
<div id="reg-page" class="page">
  <div class="auth-layout">
    <div class="auth-left">
      <div class="auth-lc"><div style="font-size:52px;margin-bottom:20px">üöÄ</div><h2>Request Access</h2><p>Submit your Gmail and your admin will add you to grant assessment access.</p></div>
    </div>
    <div class="auth-right">
      <div class="auth-card">
        <div class="back-lnk" onclick="goPage('cand-page')">‚Üê Back to login</div>
        <h1>Request Access</h1>
        <div class="auth-sub">Your admin will register your Gmail to grant access</div>
        <div class="fg"><label>Full Name *</label><input type="text" id="reg-name" placeholder="John Doe"></div>
        <div class="fg"><label>Gmail Address *</label><input type="email" id="reg-email" placeholder="yourname@gmail.com"></div>
        <div class="fg"><label>Company / Organization</label><input type="text" placeholder="Company name"></div>
        <div class="fg"><label>Message (optional)</label><textarea rows="2" placeholder="I'm applying for the Software Engineering role..."></textarea></div>
        <button class="btn btn-p btn-full" onclick="doRegReq()">Submit Request</button>
        <div class="auth-note">Have access? <a onclick="goPage('cand-page')">Sign in</a></div>
      </div>
    </div>
  </div>
</div>

<!-- ===== APP SHELL ===== -->
<div id="app-page" class="page">
  <div id="sb-overlay" class="sb-overlay" onclick="closeSB()"></div>
  <aside class="sidebar" id="sidebar">
    <div class="sb-hd">
      <div class="logo-icon" style="width:32px;height:32px;font-size:9px;flex-shrink:0">EAS</div>
      <div style="font-size:11px;font-weight:800;color:var(--p);line-height:1.3">Employability<br>Assessment System</div>
    </div>
    <nav class="sb-nav" id="sb-nav"></nav>
    <div class="sb-ft"><div class="navlink" onclick="doLogout()"><span class="ico">üö™</span> Logout</div></div>
  </aside>
  <header class="topbar" id="topbar">
    <div class="tb-left">
      <button class="menu-btn" onclick="toggleSB()">‚ò∞</button>
      <div class="bc"><b id="bc-text">Dashboard</b></div>
    </div>
    <div class="tb-right">
      <button class="dkbtn" onclick="toggleDark()" id="dk2">üåô</button>
      <div class="uav" id="uav" onclick="showView('profile')" title="Profile">?</div>
    </div>
  </header>
  <main class="main" id="main">

    <!-- ADMIN DASHBOARD -->
    <div class="view" id="view-admin-dashboard">
      <div class="ph"><div class="phr"><div><h1 id="admin-greet">Good morning! üëã</h1><p>Here's a summary of your assessment activity today.</p></div><button class="btn btn-p" onclick="showView('create-test')">+ Create Test</button></div></div>
      <div class="stats-row" id="admin-stats"></div>
      <div style="display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:24px">
        <div class="card" style="padding:22px">
          <h3 style="font-size:15px;font-weight:700;margin-bottom:18px">Score Distribution</h3>
          <div style="display:flex;align-items:flex-end;gap:10px;height:150px">
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;height:100%;justify-content:flex-end"><div style="width:100%;height:35%;border-radius:6px 6px 0 0;background:linear-gradient(180deg,#93c5fd,#2563eb)"></div><div style="font-size:11px;color:var(--t3)">0‚Äì20</div></div>
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;height:100%;justify-content:flex-end"><div style="width:100%;height:55%;border-radius:6px 6px 0 0;background:linear-gradient(180deg,#93c5fd,#2563eb)"></div><div style="font-size:11px;color:var(--t3)">21‚Äì40</div></div>
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;height:100%;justify-content:flex-end"><div style="width:100%;height:75%;border-radius:6px 6px 0 0;background:linear-gradient(180deg,#93c5fd,#2563eb)"></div><div style="font-size:11px;color:var(--t3)">41‚Äì60</div></div>
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;height:100%;justify-content:flex-end"><div style="width:100%;height:100%;border-radius:6px 6px 0 0;background:linear-gradient(180deg,#60a5fa,#1d4ed8)"></div><div style="font-size:11px;color:var(--t3)">61‚Äì80</div></div>
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;height:100%;justify-content:flex-end"><div style="width:100%;height:80%;border-radius:6px 6px 0 0;background:linear-gradient(180deg,#93c5fd,#2563eb)"></div><div style="font-size:11px;color:var(--t3)">81‚Äì100</div></div>
          </div>
        </div>
        <div class="card" style="padding:22px">
          <h3 style="font-size:15px;font-weight:700;margin-bottom:18px">Pass / Fail</h3>
          <div style="display:flex;align-items:center;justify-content:center;gap:24px">
            <svg width="110" height="110" viewBox="0 0 100 100"><circle cx="50" cy="50" r="38" fill="none" stroke="var(--b)" stroke-width="16"/><circle cx="50" cy="50" r="38" fill="none" stroke="#2563eb" stroke-width="16" stroke-dasharray="168 71" stroke-dashoffset="25" stroke-linecap="round"/><circle cx="50" cy="50" r="38" fill="none" stroke="#ef4444" stroke-width="16" stroke-dasharray="71 168" stroke-dashoffset="-143" stroke-linecap="round"/></svg>
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="display:flex;align-items:center;gap:8px;font-size:13px"><div style="width:10px;height:10px;border-radius:50%;background:#2563eb"></div>Pass 70%</div>
              <div style="display:flex;align-items:center;gap:8px;font-size:13px"><div style="width:10px;height:10px;border-radius:50%;background:#ef4444"></div>Fail 30%</div>
            </div>
          </div>
        </div>
      </div>
      <div class="card" style="padding:22px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px"><h3 style="font-size:15px;font-weight:700">üèÜ Top Performers</h3><button class="btn btn-s btn-sm" onclick="showView('results')">View All</button></div>
        <div class="tbl-wrap" id="top-performers"></div>
      </div>
    </div>

    <!-- CANDIDATES VIEW -->
    <div class="view" id="view-candidates">
      <div class="ph"><div class="phr"><div><h1>Candidates</h1><p>Add candidates by Gmail to grant assessment access</p></div><button class="btn btn-p" onclick="openAddCand()">‚ûï Add Candidate Gmail</button></div></div>
      <div class="card" style="padding:22px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px">
          <h3 style="font-size:15px;font-weight:700">Registered Candidates (<span id="cand-count">0</span>)</h3>
          <div class="sbox"><span class="sicon">üîç</span><input type="text" placeholder="Search name or Gmail..." oninput="filterCands(this.value)" style="width:220px"></div>
        </div>
        <div id="cand-list"></div>
      </div>
    </div>

    <!-- TESTS VIEW -->
    <div class="view" id="view-tests">
      <div class="ph"><div class="phr"><div><h1>Tests</h1><p>Create and manage all your assessments</p></div><button class="btn btn-p" onclick="showView('create-test')">+ Create Test</button></div></div>
      <div class="tgrid" id="tests-grid"></div>
    </div>

    <!-- CREATE TEST -->
    <div class="view" id="view-create-test">
      <div class="ph"><h1>Create New Test</h1><p>Build a custom assessment for your candidates</p></div>
      <div class="create-layout">
        <div>
          <div class="card" style="padding:22px;margin-bottom:18px">
            <h3 style="font-size:15px;font-weight:700;margin-bottom:18px">üìã Test Details</h3>
            <div class="fg"><label>Test Title *</label><input type="text" id="ct-title" placeholder="e.g. Full Stack Development Assessment"></div>
            <div class="fg"><label>Description</label><textarea rows="2" id="ct-desc" placeholder="What this test covers..."></textarea></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
              <div class="fg"><label>Duration (minutes)</label><input type="number" id="ct-dur" value="60" min="5"></div>
              <div class="fg"><label>Total Marks</label><input type="number" id="ct-marks" value="100" min="1"></div>
            </div>
            <div class="fg"><label>Passing Percentage (%)</label><input type="number" id="ct-pass" value="60" min="0" max="100"></div>
            <div class="fg"><label>Difficulty</label><select id="ct-diff"><option value="1">Easy</option><option value="2" selected>Medium</option><option value="3">Hard</option></select></div>
          </div>
        </div>
        <div>
          <div class="card" style="padding:22px">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
              <h3 style="font-size:15px;font-weight:700">‚ùì Questions <span id="q-count-lbl" style="color:var(--t3);font-weight:400;font-size:13px">(0)</span></h3>
              <button class="btn btn-p btn-sm" onclick="addBQ()">+ Add Question</button>
            </div>
            <div id="bq-container"></div>
            <div style="display:flex;gap:10px;margin-top:16px">
              <button class="btn btn-s" style="flex:1;justify-content:center" onclick="saveDraft()">üíæ Save Draft</button>
              <button class="btn btn-p" style="flex:1;justify-content:center" onclick="publishTest()">üöÄ Publish Test</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RESULTS (Admin) -->
    <div class="view" id="view-results">
      <div class="ph"><div class="phr"><div><h1>Results</h1><p>All candidate assessment results</p></div><button class="btn btn-p" onclick="exportCSV()">üì§ Export CSV</button></div></div>
      <div class="card" style="padding:22px">
        <div class="toolbar">
          <div class="sbox"><span class="sicon">üîç</span><input type="text" placeholder="Search candidates..." oninput="filterResults(this.value)"></div>
          <div style="display:flex;gap:10px">
            <select style="width:auto" onchange="filterResultsByTest(this.value)" id="res-test-f"><option value="">All Tests</option></select>
            <select style="width:auto" onchange="filterResultsByStatus(this.value)"><option value="">All Status</option><option>Passed</option><option>Failed</option></select>
          </div>
        </div>
        <div class="tbl-wrap"><table><thead><tr><th>Rank</th><th>Candidate</th><th>Test</th><th>Score</th><th>%</th><th>Time</th><th>Date</th><th>Status</th><th></th></tr></thead><tbody id="res-tbody"></tbody></table></div>
      </div>
    </div>

    <!-- CANDIDATE DASHBOARD -->
    <div class="view" id="view-candidate-dashboard">
      <div class="ph"><h1 id="cand-greet">Hello! üëã</h1><p>Ready for your next assessment?</p></div>
      <div class="stats-row" id="cand-stats"></div>
      <h2 style="font-size:17px;font-weight:700;margin-bottom:14px">Available Tests</h2>
      <div id="avail-tests" class="tgrid"></div>
      <div id="no-tests" class="hidden" style="text-align:center;padding:60px 20px;color:var(--t3)">
        <div style="font-size:44px;margin-bottom:14px">üì≠</div>
        <div style="font-size:17px;font-weight:700;margin-bottom:8px">No Tests Available</div>
        <div style="font-size:14px">Your admin hasn't published any active tests yet. Check back soon!</div>
      </div>
      <div id="completed-sec">
        <h2 style="font-size:17px;font-weight:700;margin:24px 0 14px">Completed Tests</h2>
        <div id="completed-list"></div>
      </div>
    </div>

    <!-- TAKE TEST -->
    <div class="view" id="view-take-test">
      <div class="test-layout">
        <div>
          <div class="timer-row">
            <div><div style="font-size:12px;color:var(--t2);margin-bottom:3px">Time Remaining</div><div class="timer-disp" id="timer-disp">00:00:00</div></div>
            <div style="display:flex;align-items:center;gap:16px">
              <div style="text-align:center"><div style="font-size:22px;font-weight:800;color:var(--p)" id="q-cur">1</div><div style="font-size:11px;color:var(--t3)" id="q-tot">of 0</div></div>
              <div><div style="font-size:12px;color:var(--t2);margin-bottom:4px">Progress</div><div class="pbar" style="width:120px"><div class="pbar-fill" id="t-prog" style="width:0%"></div></div></div>
              <div style="font-size:13px;color:var(--t2)" id="ans-count">0 answered</div>
            </div>
          </div>
          <div class="qpanel">
            <div class="qmeta" id="q-meta">QUESTION 1</div>
            <div class="qtext" id="q-text">Loading...</div>
            <div id="q-opts"></div>
            <div class="qnav"><button class="btn btn-s" id="btn-prev" onclick="prevQ()">‚Üê Previous</button><button class="btn btn-p" id="btn-next" onclick="nextQ()">Next ‚Üí</button></div>
          </div>
        </div>
        <div>
          <div class="card" style="padding:16px;margin-bottom:14px">
            <div style="font-size:13px;font-weight:700;color:var(--t2);margin-bottom:12px">Question Map</div>
            <div class="qdotgrid" id="q-dotgrid"></div>
            <div style="margin-top:12px;display:flex;flex-direction:column;gap:5px;font-size:12px;color:var(--t2)">
              <div style="display:flex;align-items:center;gap:6px"><div style="width:9px;height:9px;border-radius:2px;background:var(--g)"></div>Answered</div>
              <div style="display:flex;align-items:center;gap:6px"><div style="width:9px;height:9px;border-radius:2px;border:2px solid var(--p)"></div>Current</div>
              <div style="display:flex;align-items:center;gap:6px"><div style="width:9px;height:9px;border-radius:2px;background:var(--b)"></div>Unanswered</div>
            </div>
          </div>
          <button class="btn btn-d btn-full" onclick="confirmSubmit()">üö© Submit Test</button>
        </div>
      </div>
    </div>

    <!-- TEST RESULT -->
    <div class="view" id="view-test-result">
      <div class="result-hero">
        <div class="score-circle"><div class="pct" id="r-pct">0%</div><div class="of-lbl">Score</div></div>
        <div style="font-size:24px;font-weight:800;margin-bottom:8px" id="r-verdict">‚Äî</div>
        <div style="opacity:.9;font-size:14px" id="r-tname">‚Äî</div>
      </div>
      <div class="result-grid">
        <div class="card rstat"><div class="rv" style="color:var(--p)" id="r-marks">‚Äî</div><div class="rk">Marks</div></div>
        <div class="card rstat"><div class="rv" style="color:var(--p)" id="r-time">‚Äî</div><div class="rk">Time Taken</div></div>
        <div class="card rstat"><div class="rv" style="color:var(--g)" id="r-correct">‚Äî</div><div class="rk">Correct</div></div>
        <div class="card rstat"><div class="rv" style="color:var(--r)" id="r-wrong">‚Äî</div><div class="rk">Wrong</div></div>
      </div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <button class="btn btn-p btn-lg" onclick="showView('candidate-dashboard')">‚Üê Dashboard</button>
        <button class="btn btn-s btn-lg" onclick="reviewAnswers()">üìã Review Answers</button>
      </div>
    </div>

    <!-- MY RESULTS -->
    <div class="view" id="view-my-results">
      <div class="ph"><h1>My Results</h1><p>Your completed assessment history</p></div>
      <div id="my-results-list"></div>
    </div>

    <!-- PROFILE -->
    <div class="view" id="view-profile">
      <div class="ph"><h1>Profile Settings</h1></div>
      <div class="profile-layout">
        <div class="card profile-left">
          <div class="profile-av" id="profile-av">?</div>
          <div style="font-size:17px;font-weight:800" id="pname">‚Äî</div>
          <div style="font-size:13px;color:var(--t2);margin-top:3px" id="prole">‚Äî</div>
          <div style="font-size:12px;color:var(--t3);margin-top:3px" id="pemail">‚Äî</div>
          <div style="margin-top:18px;padding-top:18px;border-top:1px solid var(--b)"><div style="display:flex;justify-content:space-between;font-size:13px"><span style="color:var(--t2)">Role</span><strong id="prole-badge">‚Äî</strong></div></div>
        </div>
        <div>
          <div class="card" style="padding:22px;margin-bottom:18px">
            <h3 style="font-size:15px;font-weight:700;margin-bottom:18px">Personal Information</h3>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px"><div class="fg"><label>First Name</label><input id="pf-first" value=""></div><div class="fg"><label>Last Name</label><input id="pf-last" value=""></div></div>
            <div class="fg"><label>Email</label><input type="email" id="pf-email" readonly style="background:var(--bg);cursor:not-allowed"></div>
            <div class="fg"><label>Phone</label><input placeholder="+91 98765 43210"></div>
            <button class="btn btn-p" onclick="toast('Profile updated!','success')">Save Changes</button>
          </div>
          <div class="card" style="padding:22px">
            <h3 style="font-size:15px;font-weight:700;margin-bottom:18px">Change Password</h3>
            <div class="fg"><label>Current Password</label><input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
            <div class="fg"><label>New Password</label><input type="password" placeholder="Min. 8 characters"></div>
            <div class="fg"><label>Confirm Password</label><input type="password" placeholder="Repeat new password"></div>
            <button class="btn btn-s" onclick="toast('Password updated!','success')">Update Password</button>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const A = {
  user: null,
  dark: false,
  sbOpen: true,
  gmMode: '',
  bqs: [], // builder questions
  lastResult: null,
  confirmCb: null,
  session: { testId:null, qi:0, answers:[], startTime:null, timerInt:null, violations:0 },

  tests: [
    { id:1, title:'Full Stack Development', desc:'React, Node.js, databases, REST APIs', dur:90, marks:100, pass:60, diff:2, active:true, date:'Jan 15, 2024',
      qs:[{q:'What does JSX stand for?',opts:['JavaScript XML','Java Syntax Extension','JavaScript Extension','JSON eXchange'],ans:0},
          {q:'Which React hook manages state?',opts:['useEffect','useRef','useState','useContext'],ans:2},
          {q:'What is Node.js?',opts:['A frontend framework','A server-side JS runtime','A CSS preprocessor','A database'],ans:1},
          {q:'Which HTTP method creates a resource in REST?',opts:['GET','PUT','POST','DELETE'],ans:2},
          {q:'What does SQL stand for?',opts:['Structured Query Language','Simple Query Logic','Server Query Language','Standard Query List'],ans:0}]},
    { id:2, title:'JavaScript Fundamentals', desc:'Core JS, ES6+, closures, async/await', dur:45, marks:50, pass:60, diff:1, active:true, date:'Jan 20, 2024',
      qs:[{q:'What is a closure?',opts:['Browser close event','Function retaining outer scope access','Method to end execution','A type of loop'],ans:1},
          {q:'Which declares a block-scoped variable?',opts:['var','global','let','function'],ans:2},
          {q:'What does async/await do?',opts:['Runs parallel threads','Makes async code look synchronous','Speeds execution','Imports modules'],ans:1},
          {q:'What is typeof null?',opts:['"null"','"undefined"','"object"','"string"'],ans:2},
          {q:'Which converts JSON string to JS object?',opts:['JSON.stringify()','JSON.parse()','JSON.convert()','JSON.decode()'],ans:1}]},
    { id:3, title:'Data Science Basics', desc:'Statistics, Python, Pandas, ML concepts', dur:60, marks:80, pass:65, diff:2, active:true, date:'Feb 1, 2024',
      qs:[{q:'Which library is for data manipulation in Python?',opts:['NumPy','Flask','Pandas','Django'],ans:2},
          {q:'What is the mean of [2,4,6,8,10]?',opts:['4','5','6','7'],ans:2},
          {q:'What does CSV stand for?',opts:['Comma Separated Values','Common String Variable','Character Separated Variable','Coded String Value'],ans:0},
          {q:'Which library is built on Matplotlib for stats?',opts:['Plotly','Seaborn','Bokeh','D3.js'],ans:1},
          {q:'What is overfitting?',opts:['Model too simple','Good on training, poor on new data','Too much RAM used','Wrong labels'],ans:1}]}
  ],

  candidates: [
    {name:'Sarah Chen', email:'sarah@gmail.com', color:'#2563eb', testId:1, added:'Jan 10'},
    {name:'James Walker', email:'james@gmail.com', color:'#7c3aed', testId:2, added:'Jan 12'},
    {name:'Priya Patel', email:'priya@gmail.com', color:'#059669', testId:3, added:'Jan 15'},
    {name:'Michael Ross', email:'michael@gmail.com', color:'#d97706', testId:1, added:'Jan 18'},
  ],

  googleAccounts: [
    {name:'Admin User', email:'admin@eas.com', color:'#2563eb', role:'admin'},
    {name:'Sarah Chen', email:'sarah@gmail.com', color:'#059669', role:'candidate'},
    {name:'James Walker', email:'james@gmail.com', color:'#7c3aed', role:'candidate'},
  ],

  results: [
    {name:'Sarah Chen', email:'sarah@gmail.com', testId:1, title:'Full Stack Development', score:90, total:100, correct:4, wrong:1, skipped:0, time:'72 min', date:'Jan 25, 2024', answers:[0,2,1,2,0]},
    {name:'James Walker', email:'james@gmail.com', testId:2, title:'JavaScript Fundamentals', score:45, total:50, correct:4, wrong:1, skipped:0, time:'38 min', date:'Jan 26, 2024', answers:[1,2,1,2,1]},
    {name:'Priya Patel', email:'priya@gmail.com', testId:3, title:'Data Science Basics', score:72, total:80, correct:4, wrong:1, skipped:0, time:'52 min', date:'Jan 27, 2024', answers:[2,2,0,1,1]},
  ]
};

const colors = ['#2563eb','#7c3aed','#059669','#d97706','#dc2626','#0891b2'];
const $ = id => document.getElementById(id);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILITIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg, type='success') {
  const icons = {success:'‚úÖ',error:'‚ùå',warning:'‚ö†Ô∏è',info:'‚ÑπÔ∏è'};
  const el = document.createElement('div');
  el.className = 'toast t-'+type;
  el.innerHTML = '<span>'+icons[type]+'</span><span>'+msg+'</span>';
  $('toasts').appendChild(el);
  setTimeout(()=>{ el.style.cssText='opacity:0;transform:translateX(20px);transition:.3s'; setTimeout(()=>el.remove(),350); },3500);
}
function showLoad(m) { $('load-msg').textContent=m||'Loading...'; $('loading').classList.remove('hidden'); }
function hideLoad() { $('loading').classList.add('hidden'); }
function showM(id) { $(id).classList.remove('hidden'); }
function hideM(id) { $(id).classList.add('hidden'); }

function confirm(title, body, cb, cancelable=true) {
  $('cm-t').textContent = title;
  $('cm-b').textContent = body;
  $('cm-no').style.display = cancelable ? '' : 'none';
  A.confirmCb = cb;
  showM('cmodal');
}
$('cm-yes').onclick = () => { hideM('cmodal'); A.confirmCb && A.confirmCb(); };
$('cm-no').onclick = () => hideM('cmodal');
['cmodal','gmodal','acmodal','rmodal','dmodal'].forEach(id => {
  $(id).addEventListener('click', e => { if(e.target.id === id) hideM(id); });
});

function goPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('show'));
  const p = $(id); if(p) { p.classList.add('show'); window.scrollTo(0,0); }
}

function showView(id) {
  // Render content before showing
  const renders = {
    'admin-dashboard': renderAdminDash,
    'candidates': renderCandidates,
    'tests': renderTests,
    'results': renderResults,
    'candidate-dashboard': renderCandDash,
    'my-results': renderMyResults,
    'create-test': resetCreateForm,
  };
  if(renders[id]) renders[id]();

  document.querySelectorAll('.view').forEach(v => v.classList.remove('show'));
  const v = $('view-'+id); if(!v) return;
  v.classList.add('show');
  const lbl = id.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase());
  $('bc-text').textContent = lbl;
  document.querySelectorAll('.navlink[data-v]').forEach(nl => nl.classList.remove('active'));
  const nl = document.querySelector('.navlink[data-v="'+id+'"]');
  if(nl) nl.classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DARK MODE & SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleDark() {
  A.dark = !A.dark;
  document.body.classList.toggle('dark', A.dark);
  const ico = A.dark ? '‚òÄÔ∏è' : 'üåô';
  $('dk1') && ($('dk1').textContent = ico);
  $('dk2') && ($('dk2').textContent = ico);
}
function toggleSB() {
  if(window.innerWidth <= 768) {
    const sb = $('sidebar');
    sb.classList.toggle('mob');
    $('sb-overlay').style.display = sb.classList.contains('mob') ? 'block' : 'none';
    return;
  }
  A.sbOpen = !A.sbOpen;
  $('sidebar').classList.toggle('hide', !A.sbOpen);
  $('topbar').classList.toggle('full', !A.sbOpen);
  $('main').classList.toggle('full', !A.sbOpen);
}
function closeSB() {
  $('sidebar').classList.remove('mob');
  $('sb-overlay').style.display = 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GOOGLE MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openGM(mode) {
  A.gmMode = mode;
  $('gm-h').textContent = mode==='admin' ? 'Admin Sign In' : 'Candidate Sign In';
  $('gm-d').textContent = mode==='admin' ? 'Choose your admin Google account.' : 'Sign in with your registered Gmail.';
  const accounts = A.googleAccounts.filter(a => mode==='admin' ? a.role==='admin' : a.role==='candidate');
  $('gm-list').innerHTML = accounts.map(a =>
    '<div class="gcard" onclick="selectGA(\''+a.email+'\')"><div class="gav" style="background:'+a.color+'">'+a.name[0]+'</div><div><div style="font-weight:600;font-size:14px">'+a.name+'</div><div style="font-size:12px;color:var(--t3)">'+a.email+'</div></div></div>'
  ).join('');
  showM('gmodal');
}
function selectGA(email) {
  hideM('gmodal');
  const a = A.googleAccounts.find(x=>x.email===email);
  if(!a) { toast('Account not found','error'); return; }
  if(A.gmMode==='admin') {
    if(a.role!=='admin') { toast('This account does not have admin access','error'); return; }
    performAdminLogin({name:a.name, email:a.email});
  } else {
    const c = A.candidates.find(x=>x.email.toLowerCase()===email.toLowerCase());
    if(!c) { $('cand-nf').classList.remove('hidden'); toast('Gmail not registered. Contact your admin.','error'); return; }
    performCandLogin({name:c.name, email:c.email});
  }
}
function gmAddAccount() {
  hideM('gmodal');
  if(A.gmMode==='candidate') goPage('reg-page');
  else toast('Use your organisation Google Workspace account','info');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loginAdmin() {
  const e = $('admin-email').value.trim(), p = $('admin-pass').value.trim();
  if(!e||!p) { toast('Please fill in all fields','error'); return; }
  showLoad('Signing in...');
  setTimeout(()=>{ hideLoad(); performAdminLogin({name:'Admin User',email:e}); },900);
}
function performAdminLogin(acct) {
  showLoad('Loading dashboard...');
  setTimeout(()=>{
    hideLoad();
    A.user = {role:'admin', name:acct.name||'Admin', email:acct.email, initials:'AD'};
    setupShell();
    goPage('app-page');
    showView('admin-dashboard');
    toast('Welcome back, '+A.user.name+'! üéâ','success');
  },800);
}
function loginCand() {
  const e = $('cand-email').value.trim(), p = $('cand-pass').value.trim();
  if(!e||!p) { toast('Please fill in all fields','error'); return; }
  const c = A.candidates.find(x=>x.email.toLowerCase()===e.toLowerCase());
  if(!c) { $('cand-nf').classList.remove('hidden'); toast('Gmail not registered. Contact your admin.','error'); return; }
  showLoad('Signing in...');
  setTimeout(()=>{ hideLoad(); performCandLogin({name:c.name,email:c.email}); },900);
}
function performCandLogin(acct) {
  showLoad('Loading your dashboard...');
  setTimeout(()=>{
    hideLoad();
    const ini = acct.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
    A.user = {role:'candidate', name:acct.name, email:acct.email, initials:ini};
    setupShell();
    goPage('app-page');
    showView('candidate-dashboard');
    toast('Welcome, '+acct.name.split(' ')[0]+'! üëã','success');
  },800);
}
function doRegReq() {
  const n=$('reg-name').value.trim(), e=$('reg-email').value.trim();
  if(!n||!e) { toast('Please fill in your name and Gmail','error'); return; }
  showLoad('Submitting request...');
  setTimeout(()=>{ hideLoad(); toast('Request submitted! Admin will add your Gmail shortly.','success'); goPage('cand-page'); },1000);
}
function doLogout() {
  confirm('Sign Out','Are you sure you want to sign out?',()=>{
    clearInterval(A.session.timerInt);
    document.removeEventListener('visibilitychange', handleTabSwitch);
    A.user = null;
    toast('Signed out successfully','success');
    goPage('landing-page');
  });
}

function setupShell() {
  const u = A.user;
  $('uav').textContent = u.initials;
  $('profile-av').textContent = u.initials;
  $('pname').textContent = u.name;
  $('prole').textContent = u.role==='admin' ? 'Administrator' : 'Candidate';
  $('pemail').textContent = u.email;
  $('prole-badge').textContent = u.role==='admin' ? 'üõ°Ô∏è Admin' : 'üìù Candidate';
  const pts = u.name.split(' ');
  $('pf-first').value = pts[0]||'';
  $('pf-last').value = pts.slice(1).join(' ')||'';
  $('pf-email').value = u.email;
  const h = new Date().getHours(), gr = h<12?'morning':h<17?'afternoon':'evening';
  $('admin-greet').textContent = 'Good '+gr+', '+u.name+'! üëã';
  const nav = $('sb-nav');
  if(u.role==='admin') {
    nav.innerHTML = `
      <div class="nav-sec-lbl">Main</div>
      <div class="navlink" data-v="admin-dashboard" onclick="showView('admin-dashboard')"><span class="ico">üìä</span>Dashboard</div>
      <div class="navlink" data-v="tests" onclick="showView('tests')"><span class="ico">üìã</span>Tests</div>
      <div class="navlink" data-v="create-test" onclick="showView('create-test')"><span class="ico">‚ûï</span>Create Test</div>
      <div class="navlink" data-v="results" onclick="showView('results')"><span class="ico">üìà</span>Results</div>
      <div class="navlink" data-v="candidates" onclick="showView('candidates')"><span class="ico">üë•</span>Candidates</div>
      <div class="nav-sec-lbl">Account</div>
      <div class="navlink" data-v="profile" onclick="showView('profile')"><span class="ico">üë§</span>Profile</div>`;
  } else {
    nav.innerHTML = `
      <div class="nav-sec-lbl">Main</div>
      <div class="navlink" data-v="candidate-dashboard" onclick="showView('candidate-dashboard')"><span class="ico">üè†</span>Dashboard</div>
      <div class="navlink" data-v="my-results" onclick="showView('my-results')"><span class="ico">üìà</span>My Results</div>
      <div class="nav-sec-lbl">Account</div>
      <div class="navlink" data-v="profile" onclick="showView('profile')"><span class="ico">üë§</span>Profile</div>`;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAdminDash() {
  $('admin-stats').innerHTML = `
    <div class="card scard"><div class="sico" style="background:#dbeafe">üë•</div><div class="snum">${A.candidates.length}</div><div class="slbl">Total Candidates</div></div>
    <div class="card scard"><div class="sico" style="background:#ede9fe">üìã</div><div class="snum">${A.tests.length}</div><div class="slbl">Total Tests</div></div>
    <div class="card scard"><div class="sico" style="background:#d1fae5">‚úÖ</div><div class="snum">${A.tests.filter(t=>t.active).length}</div><div class="slbl">Active Tests</div></div>
    <div class="card scard"><div class="sico" style="background:#fef3c7">üèÜ</div><div class="snum">${A.results.length}</div><div class="slbl">Submissions</div></div>`;
  const sorted = [...A.results].sort((a,b)=>(b.score/b.total)-(a.score/a.total)).slice(0,5);
  const medals = ['gold','silver','bronze','',''];
  $('top-performers').innerHTML = sorted.length===0
    ? '<p style="text-align:center;padding:30px;color:var(--t3)">No results yet. Results will appear here after candidates complete tests.</p>'
    : '<table><thead><tr><th>Rank</th><th>Candidate</th><th>Test</th><th>Score</th><th>%</th><th>Status</th></tr></thead><tbody>'+
      sorted.map((r,i)=>{
        const t = A.tests.find(x=>x.id===r.testId);
        const pct = Math.round(r.score/r.total*100);
        const passed = pct>=(t?t.pass:60);
        return '<tr><td><div class="rnk '+medals[i]+'">'+(i+1)+'</div></td><td><div style="font-weight:600">'+r.name+'</div><div style="font-size:12px;color:var(--t3)">'+r.email+'</div></td><td>'+r.title+'</td><td>'+r.score+'/'+r.total+'</td><td><b>'+pct+'%</b></td><td><span class="badge '+(passed?'b-green':'b-red')+'">'+(passed?'Passed':'Failed')+'</span></td></tr>';
      }).join('')+'</tbody></table>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CANDIDATES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openAddCand() {
  $('ac-name').value=''; $('ac-email').value='';
  $('ac-err').style.display='none'; $('ac-email').style.borderColor='';
  const sel = $('ac-test');
  sel.innerHTML = '<option value="">‚Äî No test assigned ‚Äî</option>';
  A.tests.forEach(t=>{ const o=document.createElement('option'); o.value=t.id; o.textContent=t.title; sel.appendChild(o); });
  showM('acmodal');
}
function doAddCand() {
  const name = $('ac-name').value.trim();
  const email = $('ac-email').value.trim();
  const testId = $('ac-test').value;
  const err = $('ac-err');
  if(!name||!email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    err.textContent='Please enter a valid name and email address.'; err.style.display='block';
    $('ac-email').style.borderColor='var(--r)'; return;
  }
  if(A.candidates.find(c=>c.email.toLowerCase()===email.toLowerCase())) { toast('This Gmail is already registered!','warning'); return; }
  const color = colors[A.candidates.length % colors.length];
  A.candidates.push({name,email,color,testId:testId?Number(testId):null,added:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'})});
  A.googleAccounts.push({name,email,color,role:'candidate'});
  hideM('acmodal');
  renderCandidates();
  toast('‚úÖ '+name+' ('+email+') added as candidate!','success');
}
function renderCandidates() {
  $('cand-count').textContent = A.candidates.length;
  const list = $('cand-list');
  if(!A.candidates.length) { list.innerHTML='<div style="text-align:center;padding:40px;color:var(--t3)">No candidates yet. Click "Add Candidate Gmail" to get started.</div>'; return; }
  list.innerHTML = A.candidates.map((c,i)=>{
    const ini = c.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
    const test = c.testId ? A.tests.find(t=>t.id===c.testId) : null;
    return '<div class="cand-item"><div style="display:flex;align-items:center;gap:12px"><div class="cav" style="background:'+c.color+'">'+ini+'</div><div><div style="font-weight:600;font-size:14px">'+c.name+'</div><div style="font-size:12px;color:var(--t3)">'+c.email+'</div></div></div><div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap"><span class="badge '+(test?'b-blue':'b-yellow')+'" style="font-size:11px">'+(test?test.title:'No test assigned')+'</span><span style="font-size:12px;color:var(--t3)">Added '+c.added+'</span><button class="btn btn-s btn-sm" onclick="toast(\'Invite sent to '+c.email+'!\',\'success\')">üìß Invite</button><button class="btn btn-d btn-sm" onclick="removeCand('+i+')">üóëÔ∏è</button></div></div>';
  }).join('');
}
function filterCands(q) {
  document.querySelectorAll('.cand-item').forEach(el=>{
    el.style.display = el.textContent.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
  });
}
function removeCand(i) {
  confirm('Remove Candidate','Remove '+A.candidates[i].name+' ('+A.candidates[i].email+')?',()=>{
    const removed = A.candidates.splice(i,1)[0];
    const gi = A.googleAccounts.findIndex(a=>a.email===removed.email);
    if(gi>-1) A.googleAccounts.splice(gi,1);
    renderCandidates();
    toast('Candidate removed','success');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TESTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTests() {
  const grid = $('tests-grid');
  let html = A.tests.map(t=>`
    <div class="card tcard" id="tc-${t.id}">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px">
        <div><div class="tcard-title">${t.title}</div><div style="font-size:12px;color:var(--t3);margin-top:3px">${t.date}</div></div>
        <span class="badge ${t.active?'b-green':'b-yellow'}" id="tbadge-${t.id}">${t.active?'Active':'Inactive'}</span>
      </div>
      <div class="tcard-meta">
        <div class="tcard-mi">‚è±Ô∏è ${t.dur} minutes</div>
        <div class="tcard-mi">üìù ${t.qs.length} questions</div>
        <div class="tcard-mi">üíØ ${t.marks} marks &nbsp;¬∑&nbsp; Pass: ${t.pass}%</div>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div style="display:flex;gap:7px">
          <button class="btn btn-s btn-sm" onclick="toast('Test editor coming soon!','info')">‚úèÔ∏è Edit</button>
          <button class="btn btn-d btn-sm" onclick="deleteTest(${t.id})">üóëÔ∏è</button>
        </div>
        <label class="tsw"><input type="checkbox" ${t.active?'checked':''} onchange="toggleTest(${t.id},this)"><span class="tsl"></span></label>
      </div>
    </div>`).join('');
  html += '<div class="add-tcard" onclick="showView(\'create-test\')"><div class="plus">+</div><div class="txt">Create New Test</div></div>';
  grid.innerHTML = html;
}
function toggleTest(id, cb) {
  const t = A.tests.find(x=>x.id===id); if(!t) return;
  t.active = cb.checked;
  const badge = $('tbadge-'+id);
  if(badge) { badge.textContent = t.active?'Active':'Inactive'; badge.className='badge '+(t.active?'b-green':'b-yellow'); }
  toast('Test "'+ t.title+'" '+(t.active?'activated':'deactivated'),'success');
}
function deleteTest(id) {
  const t = A.tests.find(x=>x.id===id);
  confirm('Delete Test','Delete "'+t.title+'"? This cannot be undone.',()=>{
    A.tests = A.tests.filter(x=>x.id!==id);
    renderTests();
    toast('"'+t.title+'" deleted','success');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CREATE TEST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function resetCreateForm() {
  $('ct-title').value=''; $('ct-desc').value='';
  $('ct-dur').value=60; $('ct-marks').value=100; $('ct-pass').value=60; $('ct-diff').value=2;
  A.bqs = [];
  renderBQ();
}
function addBQ() {
  saveBQData(); // save existing before adding
  A.bqs.push({q:'',opts:['Option A','Option B','Option C','Option D'],ans:0});
  renderBQ();
  setTimeout(()=>{ const last=document.querySelector('#bq-container .qcard:last-child'); if(last) last.scrollIntoView({behavior:'smooth',block:'nearest'}); },100);
}
function saveBQData() {
  A.bqs.forEach((_,i)=>{
    const ta = document.querySelector('#bq-'+i+' textarea');
    if(ta) A.bqs[i].q = ta.value;
    [0,1,2,3].forEach(j=>{ const inp=document.querySelector('#bqopt-'+i+'-'+j); if(inp) A.bqs[i].opts[j]=inp.value; });
  });
}
function renderBQ() {
  $('q-count-lbl').textContent = '('+A.bqs.length+')';
  $('bq-container').innerHTML = A.bqs.map((bq,i)=>`
    <div class="qcard" id="bq-${i}">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <span style="font-size:13px;font-weight:700;color:var(--p)">Question ${i+1}</span>
        <button class="btn btn-s btn-sm" style="padding:4px 10px" onclick="removeBQ(${i})">‚úï</button>
      </div>
      <div class="fg"><label>Question Text</label><textarea rows="2" placeholder="Enter your question here..." oninput="A.bqs[${i}].q=this.value">${bq.q}</textarea></div>
      <label style="margin-bottom:7px">Options ‚Äî click the circle to mark the correct answer</label>
      <div class="opts-grid">
        ${['A','B','C','D'].map((ltr,j)=>`
          <div class="opt-row${bq.ans===j?' correct':''}" onclick="setBQCorrect(${i},${j})" id="bqrow-${i}-${j}">
            <div class="opt-radio" id="bqrad-${i}-${j}">${bq.ans===j?'<div style=\'width:6px;height:6px;border-radius:50%;background:#fff\'></div>':''}</div>
            <input type="text" id="bqopt-${i}-${j}" value="${bq.opts[j]||''}" placeholder="Option ${ltr}"
              oninput="A.bqs[${i}].opts[${j}]=this.value;event.stopPropagation()"
              onclick="event.stopPropagation()">
          </div>`).join('')}
      </div>
    </div>`).join('');
}
function removeBQ(i) {
  saveBQData();
  A.bqs.splice(i,1);
  renderBQ();
}
function setBQCorrect(qIdx, optIdx) {
  saveBQData();
  A.bqs[qIdx].ans = optIdx;
  // Update UI without full re-render
  [0,1,2,3].forEach(j=>{
    const row = $('bqrow-'+qIdx+'-'+j), rad = $('bqrad-'+qIdx+'-'+j);
    if(row) row.classList.toggle('correct', j===optIdx);
    if(rad) rad.innerHTML = j===optIdx ? '<div style="width:6px;height:6px;border-radius:50%;background:#fff"></div>' : '';
    if(j===optIdx && rad) { rad.style.borderColor='var(--g)'; rad.style.background='var(--g)'; }
    else if(rad) { rad.style.borderColor=''; rad.style.background=''; }
  });
}
function saveDraft() {
  saveBQData();
  toast('Draft "'+($('ct-title').value||'Untitled')+'" saved!','success');
}
function publishTest() {
  saveBQData();
  const title = $('ct-title').value.trim();
  if(!title) { toast('Please enter a test title','error'); $('ct-title').focus(); return; }
  if(!A.bqs.length) { toast('Please add at least 1 question','error'); return; }
  for(let i=0;i<A.bqs.length;i++) {
    if(!A.bqs[i].q.trim()) { toast('Question '+(i+1)+' text is empty','error'); return; }
    if(A.bqs[i].opts.some(o=>!o.trim())) { toast('Question '+(i+1)+' has empty options','error'); return; }
  }
  showLoad('Publishing test...');
  setTimeout(()=>{
    hideLoad();
    const newId = Math.max(0,...A.tests.map(t=>t.id))+1;
    A.tests.push({
      id:newId, title, desc:$('ct-desc').value.trim(),
      dur:parseInt($('ct-dur').value)||60, marks:parseInt($('ct-marks').value)||100,
      pass:parseInt($('ct-pass').value)||60, diff:parseInt($('ct-diff').value)||2,
      active:true, date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),
      qs: A.bqs.map(bq=>({q:bq.q.trim(), opts:[...bq.opts], ans:bq.ans}))
    });
    toast('‚úÖ "'+title+'" published! Candidates can now take this test.','success');
    showView('tests');
  },1000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULTS (Admin) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderResults() {
  const sel = $('res-test-f');
  sel.innerHTML = '<option value="">All Tests</option>';
  A.tests.forEach(t=>{ const o=document.createElement('option'); o.value=t.id; o.textContent=t.title; sel.appendChild(o); });
  renderResultsTable(A.results);
}
function renderResultsTable(results) {
  const sorted = [...results].sort((a,b)=>(b.score/b.total)-(a.score/a.total));
  const medals = ['gold','silver','bronze','','','','','','',''];
  $('res-tbody').innerHTML = sorted.length===0
    ? '<tr><td colspan="9" style="text-align:center;padding:40px;color:var(--t3)">No results yet.</td></tr>'
    : sorted.map((r,i)=>{
        const t=A.tests.find(x=>x.id===r.testId);
        const pct=Math.round(r.score/r.total*100);
        const passed=pct>=(t?t.pass:60);
        return '<tr><td><div class="rnk '+(medals[i]||'')+'">'+(i+1)+'</div></td><td><b>'+r.name+'</b><div style="font-size:12px;color:var(--t3)">'+r.email+'</div></td><td>'+r.title+'</td><td>'+r.score+'/'+r.total+'</td><td>'+pct+'%</td><td>'+r.time+'</td><td>'+r.date+'</td><td><span class="badge '+(passed?'b-green':'b-red')+'">'+(passed?'Passed':'Failed')+'</span></td><td><button class="btn btn-g btn-sm" onclick="showResultDetail(\''+r.email+'\','+r.testId+')">View</button></td></tr>';
      }).join('');
}
function filterResults(q) { renderResultsTable(A.results.filter(r=>r.name.toLowerCase().includes(q.toLowerCase())||r.email.toLowerCase().includes(q.toLowerCase())||r.title.toLowerCase().includes(q.toLowerCase()))); }
function filterResultsByTest(tid) { renderResultsTable(tid?A.results.filter(r=>r.testId===Number(tid)):A.results); }
function filterResultsByStatus(s) {
  if(!s){renderResultsTable(A.results);return;}
  renderResultsTable(A.results.filter(r=>{const t=A.tests.find(x=>x.id===r.testId);const pct=Math.round(r.score/r.total*100);const passed=pct>=(t?t.pass:60);return s==='Passed'?passed:!passed;}));
}
function showResultDetail(email, testId) {
  const r=A.results.find(x=>x.email===email&&x.testId===testId); if(!r) return;
  const t=A.tests.find(x=>x.id===testId);
  const pct=Math.round(r.score/r.total*100); const passed=pct>=(t?t.pass:60);
  $('rm-t').textContent = r.name+' ‚Äî '+r.title;
  $('rm-b').innerHTML = `<div style="text-align:center;padding:22px;background:linear-gradient(135deg,var(--p),var(--pu));border-radius:12px;color:#fff;margin-bottom:18px"><div style="font-size:40px;font-weight:800">${pct}%</div><div style="font-size:18px;font-weight:700;margin-top:5px">${passed?'‚úÖ Passed':'‚ùå Failed'}</div><div style="opacity:.85;font-size:13px;margin-top:4px">${r.date}</div></div>
  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px">
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--p)">${r.score}/${r.total}</div><div style="font-size:12px;color:var(--t2)">Score</div></div>
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--p)">${r.time}</div><div style="font-size:12px;color:var(--t2)">Time Taken</div></div>
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--g)">${r.correct}</div><div style="font-size:12px;color:var(--t2)">Correct</div></div>
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--r)">${r.wrong}</div><div style="font-size:12px;color:var(--t2)">Wrong</div></div>
  </div>
  <div style="display:flex;gap:10px;justify-content:flex-end">
    <button class="btn btn-p btn-sm" onclick="toast('Exporting PDF...','success')">üì§ Export PDF</button>
    <button class="btn btn-s btn-sm" onclick="toast('Email sent to candidate!','success')">üìß Email Candidate</button>
  </div>`;
  showM('rmodal');
}
function exportCSV() {
  showLoad('Preparing export...');
  setTimeout(()=>{ hideLoad(); toast('results_export.csv downloaded!','success'); },1000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CANDIDATE DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCandDash() {
  const u = A.user;
  $('cand-greet').textContent = 'Hello, '+u.name.split(' ')[0]+'! üëã';
  const myResults = A.results.filter(r=>r.email===u.email);
  const completedIds = new Set(myResults.map(r=>r.testId));
  const availTests = A.tests.filter(t=>t.active && !completedIds.has(t.id));
  const avg = myResults.length ? Math.round(myResults.reduce((s,r)=>s+r.score/r.total*100,0)/myResults.length) : null;
  const allEmails = [...new Set(A.results.map(r=>r.email))];
  const ranked = allEmails.map(e=>{ const rs=A.results.filter(r=>r.email===e); return {email:e,avg:rs.reduce((s,r)=>s+r.score/r.total*100,0)/rs.length}; }).sort((a,b)=>b.avg-a.avg);
  const myRank = ranked.findIndex(x=>x.email===u.email);
  $('cand-stats').innerHTML = `
    <div class="card scard"><div class="sico" style="background:#dbeafe">üìã</div><div class="snum">${availTests.length}</div><div class="slbl">Available Tests</div></div>
    <div class="card scard"><div class="sico" style="background:#d1fae5">‚úÖ</div><div class="snum">${myResults.length}</div><div class="slbl">Completed</div></div>
    <div class="card scard"><div class="sico" style="background:#fef3c7">‚≠ê</div><div class="snum">${avg!==null?avg+'%':'‚Äî'}</div><div class="slbl">Avg Score</div></div>
    <div class="card scard"><div class="sico" style="background:#ede9fe">üèÜ</div><div class="snum">${myRank>=0?'#'+(myRank+1):'‚Äî'}</div><div class="slbl">Your Rank</div></div>`;
  const diffLabels = ['','Easy','Medium','Hard'];
  if(!availTests.length) {
    $('avail-tests').innerHTML='';
    $('no-tests').classList.remove('hidden');
  } else {
    $('no-tests').classList.add('hidden');
    $('avail-tests').innerHTML = availTests.map(t=>{
      const dots=[1,2,3].map(d=>'<div style="width:8px;height:8px;border-radius:50%;background:'+(t.diff>=d?'var(--y)':'var(--b)')+'"></div>').join('');
      return '<div class="card tcard"><div style="display:flex;gap:4px;margin-bottom:8px">'+dots+'</div><div style="font-size:10px;font-weight:700;color:var(--t3);text-transform:uppercase;margin-bottom:6px">'+(diffLabels[t.diff]||'Medium')+'</div><div style="font-size:16px;font-weight:700;margin-bottom:7px">'+t.title+'</div><div style="font-size:13px;color:var(--t2);margin-bottom:14px">'+(t.desc||'‚Äî')+'</div><div style="display:flex;flex-direction:column;gap:4px;margin-bottom:16px"><div class="tcard-mi">‚è±Ô∏è '+t.dur+' min ¬∑ '+t.qs.length+' questions</div><div class="tcard-mi">üíØ '+t.marks+' marks ¬∑ Pass: '+t.pass+'%</div></div><button class="btn btn-p btn-full" onclick="startTest('+t.id+')">Start Test ‚Üí</button></div>';
    }).join('');
  }
  const compSec = $('completed-sec');
  if(!myResults.length) { compSec.classList.add('hidden'); return; }
  compSec.classList.remove('hidden');
  $('completed-list').innerHTML = myResults.map(r=>{
    const t=A.tests.find(x=>x.id===r.testId);
    const pct=Math.round(r.score/r.total*100);
    const passed=pct>=(t?t.pass:60);
    return '<div class="card tcard" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px"><div><div style="font-size:15px;font-weight:700">'+r.title+'</div><div style="font-size:13px;color:var(--t2);margin-top:3px">'+r.date+' ¬∑ '+r.time+'</div></div><div style="display:flex;align-items:center;gap:14px;flex-wrap:wrap"><div style="text-align:center"><div style="font-size:22px;font-weight:800;color:'+(passed?'var(--g)':'var(--r)')+'">'+pct+'%</div><div style="font-size:11px;color:var(--t3)">Score</div></div><span class="badge '+(passed?'b-green':'b-red')+'">'+(passed?'Passed':'Failed')+'</span><button class="btn btn-g btn-sm" onclick="showMyResult(\''+r.email+'\','+r.testId+')">üìã Details</button></div></div>';
  }).join('');
}
function showMyResult(email, testId) {
  const r=A.results.find(x=>x.email===email&&x.testId===Number(testId)); if(!r) return;
  const t=A.tests.find(x=>x.id===Number(testId));
  const pct=Math.round(r.score/r.total*100); const passed=pct>=(t?t.pass:60);
  $('rm-t').textContent = r.title+' ‚Äî My Result';
  $('rm-b').innerHTML = `<div style="text-align:center;padding:22px;background:linear-gradient(135deg,var(--p),var(--pu));border-radius:12px;color:#fff;margin-bottom:18px"><div style="font-size:40px;font-weight:800">${pct}%</div><div style="font-size:18px;font-weight:700;margin-top:5px">${passed?'üéâ Passed!':'üòî Failed'}</div></div>
  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px">
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--p)">${r.score}/${r.total}</div><div style="font-size:12px;color:var(--t2)">Marks</div></div>
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--p)">${r.time}</div><div style="font-size:12px;color:var(--t2)">Time</div></div>
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--g)">${r.correct}</div><div style="font-size:12px;color:var(--t2)">Correct</div></div>
    <div class="card" style="padding:14px;text-align:center"><div style="font-size:22px;font-weight:800;color:var(--r)">${r.wrong}</div><div style="font-size:12px;color:var(--t2)">Wrong</div></div>
  </div>`;
  showM('rmodal');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MY RESULTS (Candidate) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMyResults() {
  const u = A.user;
  const myResults = A.results.filter(r=>r.email===u.email);
  const el = $('my-results-list');
  if(!myResults.length) {
    el.innerHTML='<div style="text-align:center;padding:60px;color:var(--t3)"><div style="font-size:44px;margin-bottom:14px">üì≠</div><div style="font-size:17px;font-weight:700;margin-bottom:8px">No Results Yet</div><div>Take a test to see your results here!</div></div>';
    return;
  }
  el.innerHTML = myResults.map(r=>{
    const t=A.tests.find(x=>x.id===r.testId);
    const pct=Math.round(r.score/r.total*100);
    const passed=pct>=(t?t.pass:60);
    return '<div class="card" style="padding:22px;margin-bottom:16px"><div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px"><div><div style="font-size:17px;font-weight:800;margin-bottom:4px">'+r.title+'</div><div style="font-size:13px;color:var(--t2)">'+r.date+' ¬∑ ‚è±Ô∏è '+r.time+'</div></div><div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap"><div style="text-align:center"><div style="font-size:28px;font-weight:800;color:'+(passed?'var(--g)':'var(--r)')+'">'+pct+'%</div><div style="font-size:11px;color:var(--t3)">SCORE</div></div><div style="text-align:center"><div style="font-size:20px;font-weight:700">'+r.score+'/'+r.total+'</div><div style="font-size:11px;color:var(--t3)">MARKS</div></div><div style="text-align:center"><div style="font-size:20px;font-weight:700;color:var(--g)">'+r.correct+'</div><div style="font-size:11px;color:var(--t3)">CORRECT</div></div><div style="text-align:center"><div style="font-size:20px;font-weight:700;color:var(--r)">'+r.wrong+'</div><div style="font-size:11px;color:var(--t3)">WRONG</div></div><span class="badge '+(passed?'b-green':'b-red')+'" style="font-size:13px;padding:6px 14px">'+(passed?'‚úÖ Passed':'‚ùå Failed')+'</span><button class="btn btn-g btn-sm" onclick="showMyResult(\''+r.email+'\','+r.testId+')">üìã Details</button></div></div></div>';
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê START TEST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startTest(testId) {
  const t = A.tests.find(x=>x.id===testId);
  if(!t) { toast('Test not found','error'); return; }
  showLoad('Loading test...');
  setTimeout(()=>{
    hideLoad();
    clearInterval(A.session.timerInt);
    A.session = { testId, qi:0, answers:new Array(t.qs.length).fill(-1), startTime:Date.now(), timerInt:null, violations:0 };
    // Navigate to take-test view directly (bypass showView render triggers)
    document.querySelectorAll('.view').forEach(v=>v.classList.remove('show'));
    $('view-take-test').classList.add('show');
    $('bc-text').textContent = 'Take Test';
    document.querySelectorAll('.navlink[data-v]').forEach(nl=>nl.classList.remove('active'));
    // Setup test UI
    $('q-tot').textContent = 'of '+t.qs.length;
    startTimer(t.dur*60);
    document.removeEventListener('visibilitychange', handleTabSwitch);
    document.addEventListener('visibilitychange', handleTabSwitch);
    renderQuestion();
    toast('Test started! Good luck! üéØ','info');
  },800);
}
function renderQuestion() {
  const s=A.session, t=A.tests.find(x=>x.id===s.testId); if(!t) return;
  const qi=s.qi, q=t.qs[qi];
  $('q-cur').textContent = qi+1;
  $('q-meta').textContent = 'QUESTION '+(qi+1)+' OF '+t.qs.length;
  $('q-text').textContent = q.q;
  $('t-prog').style.width = (((qi+1)/t.qs.length)*100)+'%';
  $('ans-count').textContent = s.answers.filter(a=>a>=0).length+' answered';
  $('q-opts').innerHTML = ['A','B','C','D'].map((ltr,j)=>
    '<button class="opt-btn'+(s.answers[qi]===j?' sel':'')+'" onclick="selectAns('+j+')">'+'<div class="opt-ltr">'+ltr+'</div>'+q.opts[j]+'</button>'
  ).join('');
  $('btn-prev').disabled = qi===0;
  $('btn-next').textContent = qi===t.qs.length-1 ? 'Submit ‚Üí' : 'Next ‚Üí';
  $('q-dotgrid').innerHTML = t.qs.map((_,i)=>{
    let cls='qdot';
    if(i===qi) cls+=' cur';
    else if(s.answers[i]>=0) cls+=' ans';
    return '<div class="'+cls+'" onclick="goToQ('+i+')">'+(i+1)+'</div>';
  }).join('');
}
function selectAns(j) { A.session.answers[A.session.qi]=j; renderQuestion(); }
function prevQ() { if(A.session.qi>0){A.session.qi--;renderQuestion();} }
function nextQ() {
  const t=A.tests.find(x=>x.id===A.session.testId);
  if(A.session.qi<t.qs.length-1){A.session.qi++;renderQuestion();}
  else confirmSubmit();
}
function goToQ(i) { A.session.qi=i; renderQuestion(); }
function confirmSubmit() {
  const ua=A.session.answers.filter(a=>a<0).length;
  const msg=ua>0?'You have '+ua+' unanswered question(s). Submit anyway?':'Submit your test? You cannot change answers after submitting.';
  confirm('Submit Test',msg,()=>{
    clearInterval(A.session.timerInt);
    document.removeEventListener('visibilitychange',handleTabSwitch);
    showLoad('Calculating results...');
    setTimeout(()=>{hideLoad();calculateResult();},1000);
  });
}
function calculateResult() {
  const s=A.session, t=A.tests.find(x=>x.id===s.testId);
  const elapsed=Math.round((Date.now()-s.startTime)/1000);
  const mm=Math.floor(elapsed/60), ss=elapsed%60;
  const timeTaken=mm+'m '+(ss>0?ss+'s':'');
  let correct=0,wrong=0,skipped=0;
  t.qs.forEach((q,i)=>{
    if(s.answers[i]===-1) skipped++;
    else if(s.answers[i]===q.ans) correct++;
    else wrong++;
  });
  const score=Math.round((correct/t.qs.length)*t.marks);
  const pct=Math.round(score/t.marks*100);
  const passed=pct>=t.pass;
  const result={name:A.user.name,email:A.user.email,testId:t.id,title:t.title,score,total:t.marks,correct,wrong,skipped,time:timeTaken,date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),answers:[...s.answers]};
  A.results = A.results.filter(r=>!(r.email===result.email&&r.testId===result.testId));
  A.results.push(result);
  A.lastResult = result;
  // Show result page
  $('r-pct').textContent = pct+'%';
  $('r-verdict').textContent = passed ? 'üéâ Excellent! You Passed!' : 'üòî Better luck next time!';
  $('r-tname').textContent = t.title+' ¬∑ '+result.date;
  $('r-marks').textContent = score+'/'+t.marks;
  $('r-time').textContent = timeTaken;
  $('r-correct').textContent = correct;
  $('r-wrong').textContent = wrong;
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('show'));
  $('view-test-result').classList.add('show');
  $('bc-text').textContent = 'Test Result';
  toast(passed?'üéâ Congratulations! You scored '+pct+'%':'You scored '+pct+'%. Keep practicing!', passed?'success':'warning');
}
function reviewAnswers() {
  const r=A.lastResult, t=A.tests.find(x=>x.id===r.testId);
  $('rm-t').textContent = 'Answer Review ‚Äî '+r.title;
  $('rm-b').innerHTML = t.qs.map((q,i)=>{
    const ua=r.answers[i], correct=q.ans, isOk=ua===correct;
    return '<div style="padding:16px;border-radius:10px;border:1.5px solid '+(isOk?'var(--g)':'var(--r)')+';background:'+(isOk?'#d1fae5':'#fee2e2')+';margin-bottom:12px"><div style="font-weight:600;margin-bottom:10px;color:var(--t)">'+(i+1)+'. '+q.q+'</div>'+
      ['A','B','C','D'].map((ltr,j)=>{
        let bg='transparent',fw='normal',suffix='';
        if(j===correct){bg='#d1fae5';fw='700';suffix+=' ‚úÖ';}
        if(j===ua&&j!==correct){bg='#fee2e2';suffix+=' ‚ùå (Your answer)';}
        if(j===ua&&j===correct){suffix+=' (Your answer)';}
        return '<div style="padding:7px 12px;border-radius:7px;background:'+bg+';font-size:13px;font-weight:'+fw+';margin-bottom:4px;color:var(--t)">'+ltr+'. '+q.opts[j]+suffix+'</div>';
      }).join('')+'</div>';
  }).join('');
  showM('rmodal');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TIMER & TAB DETECTION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startTimer(seconds) {
  clearInterval(A.session.timerInt);
  const el=$('timer-disp');
  function updateDisplay() {
    const h=Math.floor(seconds/3600),m=Math.floor((seconds%3600)/60),s=seconds%60;
    if(el) el.textContent=pad(h)+':'+pad(m)+':'+pad(s);
    if(el){ if(seconds<300) el.className='timer-disp danger'; else if(seconds<900) el.className='timer-disp warn'; else el.className='timer-disp'; }
  }
  updateDisplay();
  A.session.timerInt = setInterval(()=>{
    seconds--;
    updateDisplay();
    if(seconds<=0){clearInterval(A.session.timerInt);autoSubmit();}
  },1000);
}
function pad(n){return String(n).padStart(2,'0');}
function autoSubmit() {
  clearInterval(A.session.timerInt);
  document.removeEventListener('visibilitychange',handleTabSwitch);
  confirm('‚è∞ Time Up!','Your time has expired. The test will be auto-submitted.',()=>{
    showLoad('Submitting...');
    setTimeout(()=>{hideLoad();calculateResult();},800);
  },false);
}
function handleTabSwitch() {
  if(!document.hidden) return;
  const testView=$('view-take-test');
  if(!testView||!testView.classList.contains('show')) return;
  A.session.violations++;
  if(A.session.violations>=3){
    clearInterval(A.session.timerInt);
    document.removeEventListener('visibilitychange',handleTabSwitch);
    confirm('üö® Test Auto-Submitted','You switched tabs '+A.session.violations+' times. Your test has been auto-submitted.',()=>{
      showLoad('Submitting...');
      setTimeout(()=>{hideLoad();calculateResult();},800);
    },false);
  } else {
    toast('‚ö†Ô∏è Tab switch detected! Warning '+A.session.violations+'/3','warning');
  }
}
</script>
</body>
</html>
